<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="by Rufas Wan">
<title>QUAD Format Specification v0.2</title>
</head>
<body class="article">
<div id="header">
<h1>QUAD Format Specification v0.2</h1>
<div class="details">
<span id="author" class="author">by Rufas Wan</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_basic_file_structure">Basic File Structure</a>
<ul class="sectlevel2">
<li><a href="#_quad_object">quad_object</a></li>
<li><a href="#_tag_object">tag_object</a></li>
<li><a href="#_attach_object">attach_object</a></li>
<li><a href="#_slot_object">slot_object</a></li>
<li><a href="#_keyframe_object">keyframe_object</a></li>
<li><a href="#_keyframe_layer_object">keyframe_layer_object</a></li>
<li><a href="#_hitbox_object">hitbox_object</a></li>
<li><a href="#_hitbox_layer_object">hitbox_layer_object</a></li>
<li><a href="#_animation_object">animation_object</a></li>
<li><a href="#_animation_timeline_object">animation_timeline_object</a></li>
<li><a href="#_skeleton_object">skeleton_object</a></li>
<li><a href="#_skeleton_bone_object">skeleton_bone_object</a></li>
<li><a href="#_blend_object">blend_object</a></li>
<li><a href="#_quad_object_2">quad_object</a></li>
</ul>
</li>
<li><a href="#_revision_history">Revision History</a></li>
<li><a href="#_example">Example</a></li>
<li><a href="#_online_ver">Online Ver</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>QUAD file is mainly for 2D sprites on modern 3D graphics engine. Every drawing is a polygon in square, rectangle, or other quadrilaterals (hence the name QUAD).</p>
</div>
<div class="paragraph">
<p>The major difference from 2D sprite:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead creating a new drawing for every new frame, the sprites can be transform using GPU. Special effects uses this a lot.</p>
</li>
<li>
<p>Two transformation can be interpolate during animation. This creates a new type of sprites with doll-like movement.</p>
</li>
<li>
<p>If the 2D sprite is properly layered, its depth value can be faked, allowing dynamic lighting and shadow calculations later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The major difference from 3D model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is still animated in frames, instead of using delta time. On a normal 60 FPS (frames per seconds) game, 1 frame is 16.67 milliseconds.</p>
</li>
<li>
<p>Z or depth value are not used. It is faked on drawing for perspective correction.</p>
</li>
<li>
<p>X and Y is the same as 2D image. +X is right direction, +Y is down direction, and they are in px (pixels).</p>
</li>
<li>
<p>As every polygons are quadrilateral with 4 unique x,y coordinates, indices are not used. They are auto-generated when drawing as 2 triangles.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_file_structure">Basic File Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A QUAD file consists of multiple sub objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"keyframe" defines the drawings of a frame.</p>
</li>
<li>
<p>"hitbox" defines the areas for collusion detection for a frame.</p>
</li>
<li>
<p>"animation" defines the changes between frames over time.</p>
</li>
<li>
<p>"skeleton" defines the relationship between frames.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_quad_object">quad_object</h3>
<div class="listingblock">
<div class="content">
<pre>{
  "tag"       : <a href="#_tag_object">tag_object</a>,
  "keyframe"  : [
    <a href="#_keyframe_object">keyframe_object</a>,
    <a href="#_keyframe_object">keyframe_object</a>,
    ...
  ],
  "hitbox"    : [
    <a href="#_hitbox_object">hitbox_object</a>,
    <a href="#_hitbox_object">hitbox_object</a>,
    ...
  ],
  "animation" : [
    <a href="#_animation_object">animation_object</a>,
    <a href="#_animation_object">animation_object</a>,
    ...
  ],
  "skeleton"  : [
    <a href="#_skeleton_object">skeleton_object</a>,
    <a href="#_skeleton_object">skeleton_object</a>,
    ...
  ],
  "slot"      : [
    <a href="#_slot_object">slot_object</a>,
    <a href="#_slot_object">slot_object</a>,
    ...
  ],
  "blend"     : [
    <a href="#_blend_object">blend_object</a>,
    <a href="#_blend_object">blend_object</a>,
    ...
  ],
  "quad"      : [
    <a href="#_quad_object">quad_object</a>,
    <a href="#_quad_object">quad_object</a>,
    ...
  ],
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tag_object">tag_object</h3>
<div class="paragraph">
<p>It is to define the metadata for current QUAD file, that includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Author</p>
</li>
<li>
<p>Copyright</p>
</li>
<li>
<p>Date created</p>
</li>
<li>
<p>Version number</p>
</li>
<li>
<p>Exported by <code>SOFTWARE</code></p>
</li>
<li>
<p>Comments</p>
</li>
<li>
<p>etc&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  tag : [ any , any ... ],
  tag : any
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_attach_object">attach_object</h3>
<div class="paragraph">
<p>Used internally by an object to link with another object.</p>
</div>
<div class="paragraph">
<p>If invalid, the object is not attached.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "type" : string tag,
  "id"   : int id,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>type</strong> (required)<br>
	For linking to other objects in the QUAD file.<br>
	Valid values are: "keyframe", "hitbox", "slot", "animation" and "skeleton".</p>
</div>
<div class="paragraph">
<p><strong>id</strong> (required)<br>
	Array index to the object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_slot_object">slot_object</h3>
<div class="paragraph">
<p>Used when more than 1 object need to be attach to a frame.</p>
</div>
<div class="paragraph">
<p>A frame can consist of a sprite, a hitbox and a sound effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  <a href="#_attach_object">attach_object</a>,
  <a href="#_attach_object">attach_object</a>,
  ...
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keyframe_object">keyframe_object</h3>
<div class="paragraph">
<p>It is to define a drawing for a frame. The result is an assembled sprite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "debug" : any,
  "name"  : string,
  "layer" : [
    <a href="#_keyframe_layer_object">keyframe_layer_object</a>,
    <a href="#_keyframe_layer_object">keyframe_layer_object</a>,
    ...
  ],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "keyframe %d".</p>
</div>
<div class="paragraph">
<p><strong>layer</strong> (required)<br>
	An array of objects to be drawn from bottom to top order (Painter&#8217;s algorithm).</p>
</div>
</div>
<div class="sect2">
<h3 id="_keyframe_layer_object">keyframe_layer_object</h3>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"    : any,
  "dstquad"  : [
    number x1 , number y1 ,
    number x2 , number y2 ,
    number x3 , number y3 ,
    number x4 , number y4 ,
  ],
  "fogquad"  : [ string rgba1 , string rgba2 , string rgba3 , string rgba4 ],
  "fogquad"  : string rgba,
  "blend_id" : int id,
  "tex_id"   : int id,
  "srcquad"  : [
    number x1 , number y1 ,
    number x2 , number y2 ,
    number x3 , number y3 ,
    number x4 , number y4 ,
  ],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>dstquad</strong> (required)<br>
	Accepts 8 numbers array, or 4 pairs of x,y coordinates.<br>
	Measured in pixel (px), with +X is right direction, and +Y is down direction.<br>
	If omitted, then the layer is skipped.</p>
</div>
<div class="paragraph">
<p><strong>fogquad</strong><br>
	All strings is in "#rrggbbaa" format.<br>
	Accepts a string, or 4 strings array.<br>
	* For a string, it is duplicated 3 times to become 4 strings array.<br>
	If omitted, then it is default to "#ffffffff" (white solid).</p>
</div>
<div class="paragraph">
<p><strong>blend_id</strong> (optional , required for texture)<br>
	If omitted or it is invalid, then it is default to -1 (skipped)</p>
</div>
<div class="paragraph">
<p><strong>tex_id</strong> (optional , required for texture)<br>
	If omitted or it is invalid, then it is default to -1 (draw fog color only)</p>
</div>
<div class="paragraph">
<p><strong>srcquad</strong> (optional , required for texture)<br>
	Requires tex_id to be valid.<br>
	Accepts 8 numbers array, or 4 pairs of x,y coordinates.<br>
	Measured in pixel (px), with +X is right direction, and +Y is down direction.<br>
	If omitted, then fog color only is drawn.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hitbox_object">hitbox_object</h3>
<div class="paragraph">
<p>It is to define the areas for collusion detection for a frame.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "debug" : any,
  "name"  : string,
  "layer" : [
    <a href="#_hitbox_layer_object">hitbox_layer_object</a>,
    <a href="#_hitbox_layer_object">hitbox_layer_object</a>,
    ...
  ],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "hitbox %d".</p>
</div>
<div class="paragraph">
<p><strong>layer</strong> (required)<br>
	An array of hitbox with different properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hitbox_layer_object">hitbox_layer_object</h3>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"   : any,
  "hitquad" : [
    number x1 , number y1 ,
    number x2 , number y2 ,
    number x3 , number y3 ,
    number x4 , number y4 ,
  ],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>hitquad</strong> (required)<br>
	Accepts 8 numbers array, or 4 pairs of x,y coordinates.<br>
	Measured in pixel (px), with +X is right direction, and +Y is down direction.<br>
	If omitted, then the layer is skipped.</p>
</div>
</div>
<div class="sect2">
<h3 id="_animation_object">animation_object</h3>
<div class="paragraph">
<p>It is to define the <strong>changes</strong> between frames over time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"    : any,
  "name"     : string,
  "timeline" : [
    <a href="#_animation_timeline_object">animation_timeline_object</a>,
    <a href="#_animation_timeline_object">animation_timeline_object</a>,
    ...
  ],
  "loop_id"  : int id,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "animation %d".</p>
</div>
<div class="paragraph">
<p><strong>timeline</strong> (required)<br>
	An array of objects to be drawn in sequence.</p>
</div>
<div class="paragraph">
<p><strong>loop_id</strong><br>
	Marks the array index for next frame when timeline reaches the end.<br>
	Value 0 (zero) restarts from the beginning.<br>
	If omitted, then it is default -1 (no loop).</p>
</div>
</div>
<div class="sect2">
<h3 id="_animation_timeline_object">animation_timeline_object</h3>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"  : any,
  "time"   : number fps,
  "attach" : <a href="#_attach_object">attach_object</a>,
  "matrix" : [a,b,c,d , e,f,g,h , i,j,k,l , m,n,o,p],
  "color"  : string rgba,
  "mix"    : bool,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>time</strong> (required)<br>
	Measured in frames. For 60 FPS (frames per second), 1 frame is 16.67 milliseconds.</p>
</div>
<div class="paragraph">
<p><strong>attach</strong><br>
	If omitted, then nothing is drawn.</p>
</div>
<div class="paragraph">
<p><strong>matrix</strong><br>
	A 4x4 transformation matrix.<br>
	If omitted, then it is default to 4x4 identity matrix.</p>
</div>
<div class="paragraph">
<p><strong>color</strong><br>
	String is in "#rrggbbaa" format.<br>
	If omitted, then it is default to "#ffffffff" (white solid).</p>
</div>
<div class="paragraph">
<p><strong>mix</strong><br>
	Affects matrix and color value.<br>
	Marks the animation for the current frame is interpolated with the next frame.<br>
	* rate = t / time , t++<br>
	* matrix or color = (current * (1 - rate)) + (next * rate)<br>
	If omitted, then it is default to 0 (false)</p>
</div>
</div>
<div class="sect2">
<h3 id="_skeleton_object">skeleton_object</h3>
<div class="paragraph">
<p>It is to define the <strong>relationship</strong> between frames.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "debug" : any,
  "name"  : string,
  "bone"  : [
    <a href="#_skeleton_bone_object">skeleton_bone_object</a>,
    <a href="#_skeleton_bone_object">skeleton_bone_object</a>,
    ...
  ],
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "skeleton %d".</p>
</div>
<div class="paragraph">
<p><strong>bone</strong> (required)<br>
	An array of bones to built the skeleton.</p>
</div>
</div>
<div class="sect2">
<h3 id="_skeleton_bone_object">skeleton_bone_object</h3>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"     : any,
  "name"      : string,
  "attach"    : <a href="#_attach_object">attach_object</a>,
  "parent_id" : int id,
  "order"     : number,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "skeleton bone %d".</p>
</div>
<div class="paragraph">
<p><strong>attach</strong><br>
	If omitted, then it is invisible bone and drawing is skipped.</p>
</div>
<div class="paragraph">
<p><strong>parent_id</strong><br>
	Array index for the Bone ID to inherit transformation matrix and color from.<br>
	If omitted, or parent_id is same as current bone ID, then it is default to -1 (no parent).</p>
</div>
<div class="paragraph">
<p><strong>order</strong><br>
	Bones drawing order. Lower value mean it is drawn first (bottom layer), and highest value is drawn last.<br>
	If 2 or more bones has the same value, then these bones are ordered by its Bone ID.<br>
	If omitted, then it is default to same value as Bone ID.</p>
</div>
</div>
<div class="sect2">
<h3 id="_blend_object">blend_object</h3>
<div class="paragraph">
<p>It is to define alpha blending formula to handle transparency and semi-transparency pixels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "debug"  : any,
  "name"   : string,
  "mode"   : [
    string mode,
    string s_factor, string d_factor
  ],
  "mode"   : [
    string c_mode, string a_mode,
    string sc_factor, string dc_factor,
    string sa_factor, string da_factor
  ],
  "color"  : string rgba,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>debug</strong><br>
	Additional notes and/or comments.</p>
</div>
<div class="paragraph">
<p><strong>name</strong><br>
	Custom string to identify this object.<br>
	If omitted, then it is default to "blend %d".</p>
</div>
<div class="paragraph">
<p><strong>mode</strong> (required)<br>
	All strings are WebGL enum for <code>blendEquation()</code> and <code>blendFunc()</code>.<br>
	Accepts a 3 strings array, or a 6 strings array.<br>
	* For 3 strings array, it is 1 enum for <code>blendEquation()</code> and then 2 enum for <code>blendFunc()</code>.<br>
	* For 6 strings array, it is 2 enum for <code>blendEquationSeparate()</code> and then 4 enum for <code>blendFuncSeparate()</code>.</p>
</div>
<div class="paragraph">
<p><strong>color</strong> (if required)<br>
	Constant color for <code>blendColor()</code>.<br>
	Required when <code>blendFunc()/blendFuncSeparate()</code> uses factor "CONSTANT_COLOR", "CONSTANT_ALPHA", "ONE_MINUS_CONSTANT_COLOR" or "ONE_MINUS_CONSTANT_ALPHA".<br>
	String is in "#rrggbbaa" format.<br>
	If omitted, then it is default to "#ffffffff" (white solid).</p>
</div>
</div>
<div class="sect2">
<h3 id="_quad_object_2">quad_object</h3>
<div class="paragraph">
<p>It is to connect with another QUAD file, allowing interaction between QUAD files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "list" : pointer,
  "id"   : int id,
}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>list</strong> (required)<br>
	Pointer to array of QUAD files.</p>
</div>
<div class="paragraph">
<p><strong>id</strong> (required)<br>
	Array index to the QUAD file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history">Revision History</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">v0.2 (2023-05-11)</div>
<ul>
<li>
<p>Rewritten from scratch with dynamic attach system.</p>
</li>
<li>
<p>Object keys are standardize to be singular form in lower_snake_case.</p>
</li>
<li>
<p>Added Hitbox objects.</p>
</li>
<li>
<p>Added Slot objects.</p>
</li>
<li>
<p>Added Skeleton objects.</p>
</li>
<li>
<p>Added Blending objects.</p>
</li>
<li>
<p>Animation object is simplified to one-track only.</p>
</li>
<li>
<p>Added matrix and color mixing to Animation objects.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">v0.1 (2021-03-01)</div>
<ul>
<li>
<p>Initial release and first draft.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="sample.quad">sample.quad (2794 bytes)</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_online_ver">Online Ver</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/rufaswan/Web2D_Games/blob/master/docs/quad_player_mobile/spec.adoc" class="bare">https://github.com/rufaswan/Web2D_Games/blob/master/docs/quad_player_mobile/spec.adoc</a></p>
</li>
<li>
<p><a href="https://rufaswan.github.io/Web2D_Games/quad_player_mobile/spec.html" class="bare">https://rufaswan.github.io/Web2D_Games/quad_player_mobile/spec.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>